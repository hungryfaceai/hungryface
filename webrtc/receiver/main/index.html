<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Baby Monitor – Receiver (Menu Only)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"/>
  <style>
    :root { color-scheme: dark; --ui-pad: 12px; }

    html, body {
      margin: 0; height: 100%;
      background: #000; color: #fff;
      font-family: -apple-system, system-ui, Segoe UI, Roboto, sans-serif;
      overflow: hidden;
    }

    /* ---------- Left Sidebar (auto-hide) ---------- */
    #sidebar {
      position: fixed; top: 0; bottom: 0; left: 0;

      /* Fit to content width, but never exceed 80vw; ensure a small minimum */
      width: max-content;
      width: fit-content;
      max-width: 80vw;
      min-width: 220px;

      padding: 16px 10px 18px;
      border-right: 1px solid #1a1a1a;
      background: #0b0b0b;
      z-index: 9000;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }

    .menu {
      list-style: none; margin: 0; padding: 0;
      display: grid; gap: 8px;
    }
    .menu a, .menu button {
      display: block; width: 100%;
      text-align: left;
      color: #ddd; text-decoration: none;
      background: #141414; border: 1px solid #1f1f1f;
      padding: 10px 12px; border-radius: 10px;
      cursor: pointer; font-size: 15px;
    }
    .menu a:hover, .menu button:hover { filter: brightness(1.06); }
    .menu h3 {
      margin: 12px 6px 6px; font-size: 12px; color: #aaa; font-weight: 600; letter-spacing: .02em;
    }

    /* ---------- Invite modal (added) ---------- */
    .invite-modal {
      position: fixed; inset: 0; display: none;
      align-items: center; justify-content: center;
      background: rgba(0,0,0,0.6); z-index: 9998;
    }
    .invite-modal.visible { display: flex; }
    .invite-sheet {
      width: min(92vw, 420px);
      background: #111; color: #fff; border: 1px solid #262626;
      border-radius: 14px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      font-family: -apple-system, system-ui, Segoe UI, Roboto, sans-serif;
      position: relative;
    }
    .invite-close {
      position: absolute; top: 8px; right: 10px;
      background: transparent; border: 0; color: #aaa;
      font-size: 28px; line-height: 1; cursor: pointer;
    }
    .invite-qr-wrap { display: grid; place-items: center; margin: 10px 0 14px; }
    .invite-qr-wrap img { width: 220px; height: 220px; }

    .invite-url { display: grid; gap: 6px; margin-bottom: 12px; }
    .invite-url-label { font-size: 12px; color: #bbb; }
    #invite-url {
      width: 100%; padding: 10px 12px; border-radius: 10px;
      background: #0a0a0a; color: #ddd; border: 1px solid #232323;
    }

    .invite-actions { display: flex; gap: 10px; justify-content: flex-end; }
    #invite-copy, #invite-open {
      display: inline-flex; align-items: center; justify-content: center;
      padding: 10px 14px; border-radius: 10px; text-decoration: none;
      background: #1f1f1f; color: #fff; border: 1px solid #2b2b2b; cursor: pointer;
    }
    #invite-copy:hover, #invite-open:hover { filter: brightness(1.1); }

    .invite-toast {
      position: fixed; left: 50%; bottom: 28px; transform: translateX(-50%);
      background: #1a1a1a; color: #fff; border: 1px solid #2a2a2a;
      padding: 8px 12px; border-radius: 10px; opacity: 0; transition: opacity .2s ease;
      z-index: 10000; pointer-events: none;
    }
    .invite-toast.show { opacity: 1; }

    /* ---------- Page filler (keeps layout stable) ---------- */
    main { margin-left: 260px; padding: var(--ui-pad); }
    @media (max-width: 640px) {
      main { margin-left: 240px; }
    }
  </style>
</head>
<body>

  <!-- Sidebar menu -->
  <aside id="sidebar" aria-label="Main menu">
    <ul class="menu">
      <h3>Views</h3>
      <li><a href="https://hungryfaceai.github.io/hungryface/webrtc/receiver/video/index.html">Video</a></li>
      <li><a href="https://hungryfaceai.github.io/hungryface/webrtc/receiver/audio/index.html">Audio</a></li>
      <li><a href="https://hungryfaceai.github.io/hungryface/webrtc/receiver/pose/index.html">Pose</a></li>
      <li><a href="https://hungryfaceai.github.io/hungryface/webrtc/receiver/face/index.html">Face</a></li>

      <h3>App</h3>
      <li><a href="https://hungryfaceai.github.io/hungryface/webrtc/receiver/settings/index.html">Settings</a></li>
      <li><a href="https://hungryfaceai.github.io/hungryface/webrtc/receiver/help/index.html">Help</a></li>

      <!-- Invite menu item with fixed id -->
      <h3>Share</h3>
      <li>
        <a id="menu-invite" href="#" role="button" aria-haspopup="dialog" aria-controls="invite-modal">
          Invite a friend
        </a>
      </li>
    </ul>
  </aside>

  <main>
    <!-- Placeholder content area; unchanged app content would sit here -->
    <p style="opacity:.6">Open a view from the sidebar.</p>
  </main>

  <!-- Invite a friend — modal (added) -->
  <div id="invite-modal" class="invite-modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="invite-title">
    <div class="invite-sheet">
      <button type="button" class="invite-close" aria-label="Close">&times;</button>
      <h2 id="invite-title" style="margin:0 0 6px;">Invite a friend</h2>

      <div class="invite-qr-wrap">
        <img id="invite-qr" alt="QR code" width="220" height="220" loading="lazy">
      </div>

      <label class="invite-url">
        <span class="invite-url-label">Link</span>
        <input id="invite-url" type="text" readonly>
      </label>

      <div class="invite-actions">
        <button id="invite-copy" type="button">Copy link</button>
        <a id="invite-open" target="_blank" rel="noopener">Open</a>
      </div>
    </div>
  </div>

  <!-- JS: Invite flow (added) -->
  <script>
    (() => {
      // Fixed invite target (no room parameter)
      const INVITE_URL = 'https://hungryfaceai.github.io/hungryface/home/';
      const QR_ENDPOINT = 'https://api.qrserver.com/v1/create-qr-code/?size=220x220&format=svg&data=';

      const $ = (s, r = document) => r.querySelector(s);

      const modal   = $('#invite-modal');
      const qrImg   = $('#invite-qr');
      const urlIn   = $('#invite-url');
      const btnCopy = $('#invite-copy');
      const btnOpen = $('#invite-open');
      const btnX    = $('.invite-close');
      const trigger = $('#menu-invite');

      function toast(msg) {
        const el = document.createElement('div');
        el.className = 'invite-toast';
        el.textContent = msg;
        document.body.appendChild(el);
        requestAnimationFrame(() => el.classList.add('show'));
        setTimeout(() => {
          el.classList.remove('show');
          el.addEventListener('transitionend', () => el.remove(), { once: true });
        }, 1400);
      }

      function showInvite() {
        const url = INVITE_URL;
        qrImg.src = QR_ENDPOINT + encodeURIComponent(url);
        qrImg.alt = 'QR code for ' + url;
        urlIn.value = url;
        btnOpen.href = url;

        modal.classList.add('visible');
        modal.setAttribute('aria-hidden', 'false');

        setTimeout(() => {
          urlIn.focus({ preventScroll: true });
          try { urlIn.setSelectionRange(urlIn.value.length, urlIn.value.length); } catch {}
          urlIn.scrollLeft = urlIn.scrollWidth;
        }, 0);

        document.addEventListener('keydown', onEsc, { once: true });
      }

      function hideInvite() {
        modal.classList.remove('visible');
        modal.setAttribute('aria-hidden', 'true');
      }

      function onEsc(e) { if (e.key === 'Escape') hideInvite(); }

      // Wire up events
      trigger?.addEventListener('click', (e) => { e.preventDefault(); showInvite(); });
      modal.addEventListener('click', (e) => { if (e.target === modal) hideInvite(); });
      btnX.addEventListener('click', hideInvite);

      btnCopy.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(urlIn.value);
          toast('Link copied');
        } catch {
          urlIn.select?.();
          toast('Copy failed — select and copy');
        }
      });
    })();
  </script>
</body>
</html>
