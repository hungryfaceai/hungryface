<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<title>Offerer Minimal</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Arial;padding:16px;max-width:800px;margin:auto}
  .btn{border:1px solid #e5e7eb;background:#f8fafc;border-radius:10px;padding:8px 12px;cursor:pointer}
  textarea{width:100%;min-height:140px}
  .muted{color:#6b7280}
</style>

<h1>Offerer (Minimal)</h1>
<div class="muted" id="status">Idle</div>
<div style="margin:10px 0">
  <button class="btn" id="createOffer">Create Offer (datachannel only)</button>
</div>
<details>
  <summary class="muted">Offer SDP</summary>
  <textarea id="offerSDP" readonly></textarea>
  <div style="margin-top:6px">
    <button class="btn" id="copyOffer">Copy SDP</button>
  </div>
</details>
<div style="margin-top:10px" class="muted">
  Paste the answer SDP below (from the other device), then click Apply.
</div>
<textarea id="answerSDP" placeholder="Paste answer SDP here"></textarea>
<div style="margin-top:6px">
  <button class="btn" id="applyAnswer">Apply Answer</button>
</div>

<script>
const $ = id => document.getElementById(id);
const setStatus = s => $('status').textContent = s;

let pc = null;

async function createPeer() {
  pc = new RTCPeerConnection({ iceServers: [] });
  pc.onconnectionstatechange = () => setStatus('Peer connection: ' + pc.connectionState);
  // create a minimal datachannel so the SDP stays small
  pc.createDataChannel('dc');
  return pc;
}

async function waitIceComplete(pc){
  if (pc.iceGatheringState === 'complete') return;
  await new Promise(res=>{
    const fn=()=>{ if (pc.iceGatheringState === 'complete'){ pc.removeEventListener('icegatheringstatechange', fn); res(); } };
    pc.addEventListener('icegatheringstatechange', fn);
  });
}

$('createOffer').onclick = async () => {
  try {
    setStatus('Creating offer…');
    await createPeer();
    const offer = await pc.createOffer({ offerToReceiveAudio:false, offerToReceiveVideo:false });
    await pc.setLocalDescription(offer);
    await waitIceComplete(pc);
    $('offerSDP').value = pc.localDescription.sdp || '';
    setStatus('Offer ready. Copy and share it.');
  } catch (e) {
    console.error(e);
    alert('Create offer failed: ' + e.message);
  }
};

$('copyOffer').onclick = () => navigator.clipboard.writeText($('offerSDP').value);

$('applyAnswer').onclick = async () => {
  try {
    const sdp = $('answerSDP').value.trim();
    if (!sdp) return alert('Paste the answer SDP first.');
    await pc.setRemoteDescription(new RTCSessionDescription({ type:'answer', sdp }));
    setStatus('Answer applied. Connecting…');
  } catch (e) {
    alert('Apply answer failed: ' + e.message);
  }
};
</script>
</html>
